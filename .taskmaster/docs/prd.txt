# PRD: 簡易チャットアプリ（Supabase学習用）

## 1. 概要

### 1.1 背景

Supabase開発の学習を目的として、認証機能とリアルタイム通信を備えたシンプルなチャットアプリケーションを開発する。

### 1.2 学習目標

- 認証（Google OAuth）
- データベース操作（CRUD）
- リアルタイム通信
- アクセス制御（Row Level Security）
- ファイルストレージ
- テーブルリレーション

---

## 2. 機能要件

### 2.1 ユーザー認証

- Googleアカウントによるログイン機能
- ログアウト機能
- 初回ログイン時にプロフィール自動作成

### 2.2 プロフィール機能

- ユーザー名の表示・編集
- プロフィール画像のアップロード・変更
- プロフィール画像の表示

### 2.3 チャット機能

- 全ユーザーが参加する共通のチャットルーム
- テキストメッセージの送信
- リアルタイムでのメッセージ受信・表示
- メッセージ履歴の表示（送信者名、アバター、送信時刻）
- 自分のメッセージの削除

---

## 3. 非機能要件

- 対応ブラウザ: Chrome（最新版）
- 同時接続: 10ユーザー程度を想定

---

## 4. 画面構成

1. ログイン画面: Googleログインボタン
2. チャット画面: メッセージ一覧、入力フォーム、ヘッダー（ユーザー情報、ログアウト）
3. プロフィール編集画面: アバター変更、ユーザー名編集

---

## 5. データベース設計

### 5.1 profilesテーブル

| カラム名 | 型 | 説明 |
|---------|------|------|
| id | uuid | 主キー（auth.usersのidと同一） |
| username | text | 表示名 |
| avatar_url | text | プロフィール画像URL |
| created_at | timestamp | 作成日時 |
| updated_at | timestamp | 更新日時 |

### 5.2 messagesテーブル

| カラム名 | 型 | 説明 |
|---------|------|------|
| id | uuid | 主キー |
| user_id | uuid | 送信者ID（profilesへの外部キー） |
| content | text | メッセージ本文 |
| created_at | timestamp | 送信日時 |

### 5.3 Storage: avatarsバケット

- プロフィール画像を保存
- パス形式: `{user_id}/avatar.{ext}`

---

## 6. アクセス制御ポリシー

### 6.1 profilesテーブル

| 操作 | ポリシー |
|------|----------|
| SELECT | 認証済みユーザーは全員のプロフィールを閲覧可能 |
| UPDATE | 自分のプロフィールのみ編集可能 |

### 6.2 messagesテーブル

| 操作 | ポリシー |
|------|----------|
| SELECT | 認証済みユーザーは全メッセージを閲覧可能 |
| INSERT | 認証済みユーザーは自分のuser_idでのみ投稿可能 |
| DELETE | 自分のメッセージのみ削除可能 |

### 6.3 avatarsバケット

| 操作 | ポリシー |
|------|----------|
| SELECT | 誰でも閲覧可能（公開） |
| INSERT / UPDATE / DELETE | 自分のフォルダのみ操作可能 |

---

## 7. 開発ガイドライン

### 7.1 ドキュメント参照ルール

| タスク種別 | 参照先 |
|-----------|--------|
| プロジェクトセットアップ | CLAUDE.md |
| 技術スタック・コーディング規約 | CLAUDE.md |
| 機能要件・仕様 | 本PRD |

### 7.2 注意事項

- 環境構築、ライブラリ導入、ディレクトリ構成などの技術的なセットアップはCLAUDE.mdの指示に従うこと
- 本PRDは「何を作るか」を定義し、「どう作るか」はCLAUDE.mdに委譲する
